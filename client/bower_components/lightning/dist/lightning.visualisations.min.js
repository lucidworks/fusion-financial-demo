/*! lightning 2017-02-20 */
!function(){"use strict";function a(){var a={restrict:"E",transclude:!0,require:["?^^chartDisplay","?^^chartGauge"],link:{pre:function(a,b,c,d){var e=d[0],f=d[1],g={enabled:!0,text:c.text,href:c.href};null!=e?e.addCreditOptions(g):null!=f&&f.addCreditOptions(g)}}};return a}angular.module("lightning").directive("chartCredit",a)}(),function(){"use strict";function a(a,b,c,d,e){var f={restrict:"E",scope:{response:"@",options:"=?"},transclude:!0,controller:["$scope","$attrs","$filter","$timeout","$element","$window","$lightningLog",function(f,g,h,i,j,k,l){function m(){angular.element(k).off("resize",n)}function n(){null!=f.seriesCopy&&i(function(){var a=angular.element(j[0].querySelector("#field-name")).text(),b=angular.element(j[0].querySelector("#count")).text();angular.element(j[0].querySelector("#field-name")).remove(),angular.element(j[0].querySelector("#count")).remove();var c=f.seriesCopy,d=c.chart.renderer,e=c.chart.plotLeft+c.center[0],g=c.chart.plotTop+c.center[1];d.text(a,e,g).attr({"text-anchor":"middle","font-size":"28px","font-weight":"800",id:"field-name"}).add(),d.text(b,e,g+30).attr({"text-anchor":"middle","font-size":"26px",id:"count"}).add(),a.length>=56?angular.element(j[0].querySelector("#field-name")).attr("font-size","6px"):a.length>=35?angular.element(j[0].querySelector("#field-name")).attr("font-size","8px"):a.length>=30?angular.element(j[0].querySelector("#field-name")).attr("font-size","10px"):a.length>=25?angular.element(j[0].querySelector("#field-name")).attr("font-size","12px"):a.length>=20?angular.element(j[0].querySelector("#field-name")).attr("font-size","14px"):a.length>=16?angular.element(j[0].querySelector("#field-name")).attr("font-size","18px"):a.length>=12?angular.element(j[0].querySelector("#field-name")).attr("font-size","20px"):angular.element(j[0].querySelector("#field-name")).attr("font-size","26px")},0)}function o(){f.chartConfig.series=[],f.timeSeriesFacets=[],f.chartConfig.xAxis.categories=[],f.actCategories=[],f.singleFilterOverlay=!1,I=[],f.loading=0,f.query=d.getQueryAsHttpParams(g.query,!0)}function p(a){f.chartConfig&&f.chartConfig.series&&(g.hasOwnProperty("select")&&"checkbox"==g.select?(f.allSeries.push(a),f.chartConfig.series.length<10&&f.chartConfig.series.push(a)):f.chartConfig.series.push(a))}function q(a,b){0==f.chartConfig.series.length&&f.chartConfig.options.foo++;var c=null;("false"==b.showMarker||"true"==b.showMarker)&&(c={enabled:"true"==b.showMarker});var e=s(b.name,b.type,b.tooltipOptions,c);e.title=b.title||b.name;var i=a.header.indexOf(b.labelField),j=a.header.indexOf(b.valueField),k=a.header.indexOf(b.urlField);if(angular.forEach(a.series,function(a){if(!isNaN(a[j])){var c=parseFloat(a[j]),d=a[i],g=null!=d.act?d.act:null!=d.dsp?d.dsp:d,l=null!=d.dsp?d.dsp:d,m=null;if(-1!=k&&(m=a[k]),null!=b.dateFormat&&("undefined"!=typeof l.indexOf?0==l.indexOf("<")?(l=l.substring(1),l=h("dateFormat")(l.trim(),b.dateFormat),l="&lt; "+l):0==l.indexOf(">")?(l=l.substring(1),l=h("dateFormat")(l.trim(),b.dateFormat),l="&gt; "+l):l=h("dateFormat")(l,b.dateFormat):l=h("dateFormat")(l,b.dateFormat)),-1!=H(f.actCategories,g))e.data[H(f.actCategories,g)]=[l,c],null!=m?e.urls[H(f.actCategories,g)]=m:null!=b.query&&(e.filters[H(f.actCategories,g)]=[b.name,g,l,b.action]);else if(f.chartConfig.xAxis.categories.push(l),f.actCategories.push(g),e.data.push([l,c]),null!=m)n=e.data.length>0?e.data.length-1:0,e.urls[n]=m;else if(null!=b.query){var n=e.data.length>0?e.data.length-1:0;e.filters[n]=[b.name,g,l,b.action]}}}),f.showInterval=Math.ceil(f.chartConfig.xAxis.categories.length/g.maxLabels),f.labelCounter=0,f.i=0,p(e),G(),null!=b.query&&g.hasOwnProperty("singleFilterMode")){var l=d.convertHttpParamsToQuery(b.query);if(l.filters)for(var m=0;m<l.filters.length;m++)b.name==l.filters[m].field&&1==e.data.length&&B(b.name,e.data[0][0],e.data[0][1])}}function r(b,c){0==f.chartConfig.series.length&&f.chartConfig.options.foo++,f.timeSeriesFacets.push(c.name),0!=f.chartConfig.options.rangeSelector.enabled&&null!=c.rangeSelector&&(f.chartConfig.options.rangeSelector.enabled=c.rangeSelector),0!=f.chartConfig.options.navigator.enabled&&null!=c.navigator&&(f.chartConfig.options.navigator.enabled=c.navigator),null!=c.query&&(f.chartConfig.options.xAxis={events:{afterSetExtremes:function(b){"zoom"==b.trigger&&(angular.forEach(f.timeSeriesFacets,function(b){a.removeFiltersFromUrl(b,!1)}),angular.forEach(f.timeSeriesFacets,function(c,d){var e=new Date(b.min).toISOString(),g=new Date(b.max).toISOString(),h=e.substring(0,e.length-5),i=g.substring(0,g.length-5);a.addRangeFilterToUrl(c,h,i,e,g,d==f.timeSeriesFacets.length-1,!1,"-")}))}}}),c.title=null==c.title?c.name:c.title;var d={name:c.title,data:[],tooltip:c.tooltipOptions,type:c.type,showInNavigator:!0};void 0!=c.markerOptions&&null!=c.markerOptions&&(d.marker=c.markerOptions);var e=[],g=b.header.indexOf(c.labelField),i=b.header.indexOf(c.valueField);angular.forEach(b.series,function(a){if(!isNaN(a[i])){var b;b=null!=a[g].act?null!=a[g].act.from?a[g].act.from:null!=a[g].act.to?a[g].act.to:a[g].act:a[g],e.push({act:new Date(b).valueOf(),count:a[i]})}}),("true"==c.sort||null==c.sort)&&(e=h("orderBy")(e,"act")),angular.forEach(e,function(a){d.data.push([new Date(a.act).valueOf(),a.count])}),p(d),G(),f.$broadcast("highchartsng.reflow")}function s(c,d,e,i){d=null==d?g.type:d;var k={className:"highcharts-series-"+h("formatAsCssName")(c),name:c,data:[],type:d,urls:[],filters:[],events:{click:function(c){var d=c.point.index;if(null!=this.userOptions.urls[d])document.location=this.userOptions.urls[d];else if(null!=this.userOptions.filters[d]){var e=this.userOptions.filters[d];null!=e[3]&&b.path(e[3]);var f=e[1];null!=this.userOptions.query&&a.setUrlParameters(this.userOptions.query,!1),void 0!=f&&"range"==f.type?a.addRangeFilterDisplayToUrl(e[0],f.from,f.to,e[2],!0,!1,f.fromExcluded,f.toExcluded):a.addFilterToUrl(e[0],e[1],e[2],!0)}}},tooltip:e};return"pie"==d&&null!=g.innerSize&&"true"==g.showValue&&(k.point={events:{mouseOver:function(){f.seriesCopy=this.series,angular.element(j[0].querySelector("#field-name")).remove(),angular.element(j[0].querySelector("#count")).remove();var a=this.series,b=this.series.chart.renderer,c=this.series.chart.plotLeft+a.center[0],d=this.series.chart.plotTop+a.center[1];b.text(this.name,c,d).attr({"text-anchor":"middle","font-size":"28px","font-weight":"800",id:"field-name"}).add(),b.text(h("numberFormat")(this.y,"formatted"),c,d+30).attr({"text-anchor":"middle","font-size":"26px",id:"count"}).add(),angular.forEach(this.series.points,function(a){a.slice(!1)}),this.slice(!0),this.name.length>=56?angular.element(j[0].querySelector("#field-name")).attr("font-size","6px"):this.name.length>=35?angular.element(j[0].querySelector("#field-name")).attr("font-size","8px"):this.name.length>=30?angular.element(j[0].querySelector("#field-name")).attr("font-size","10px"):this.name.length>=25?angular.element(j[0].querySelector("#field-name")).attr("font-size","12px"):this.name.length>=20?angular.element(j[0].querySelector("#field-name")).attr("font-size","14px"):this.name.length>=16?angular.element(j[0].querySelector("#field-name")).attr("font-size","18px"):this.name.length>=12?angular.element(j[0].querySelector("#field-name")).attr("font-size","20px"):angular.element(j[0].querySelector("#field-name")).attr("font-size","26px")}}}),void 0!=i&&null!=i&&(k.marker=i),0==f.chartConfig.series.length&&void 0==f.chartConfig.options.legend?f.chartConfig.options.legend={enabled:!1}:void 0==f.chartConfig.options.legend&&(f.chartConfig.options.legend={enabled:!0}),null!=g.stacking&&(k.stacking=g.stacking),"pie"!=d&&(k.dataLabels={enabled:"true"==g.showDataLabels}),"bar"==d&&(f.chartConfig.options.chart.inverted=!0),t(d),k.data=Array.apply(null,new Array(f.chartConfig.xAxis.categories.length)).map(function(){return[null,null]}),k}function t(a){"true"==g.threeD&&("pie"==a?(f.chartConfig.options.chart.options3d={enabled:!0,alpha:45,beta:0,depth:40},f.chartConfig.options.chart.marginTop=0):(f.chartConfig.options.chart.options3d={enabled:!0,alpha:15,beta:15,viewDistance:25,depth:40},f.chartConfig.options.chart.marginTop=40,f.chartConfig.options.chart.spacingRight=60))}function u(a,b,c,d,e,j,k,l,m){if(null!=a){0==f.chartConfig.series.length&&(F(),f.chartConfig.options.foo++,i(function(){G()},500)),C(a),c=null==c?a.display:c;var n=a.field,o=s(c,b,j,m);o.title=o.title||c,o.query=d,angular.forEach(a.filters,function(a){if(!isNaN(a.count)){var b=h("actualValue")(a.val),c=h("displayValue")(a.val);if(null!=k&&("undefined"!=typeof c.indexOf?0==c.indexOf("<")?(c=c.substring(1),c=h("dateFormat")(c.trim(),k),c="&lt; "+c):0==c.indexOf(">")?(c=c.substring(1),c=h("dateFormat")(c.trim(),k),c="&gt; "+c):c=h("dateFormat")(c,k):c=h("dateFormat")(c,k)),-1!=H(f.actCategories,b))o.data[H(f.actCategories,b)]=[c,null==l||"count"==l?a.count:a.facts[l][0]],null!=d&&(o.filters[H(f.actCategories,b)]=[n,b,c,e]);else if(f.chartConfig.xAxis.categories.push(c),f.actCategories.push(b),o.data.push([c,null==l||"count"==l?a.count:a.facts[l][0]]),null!=d){var g=o.data.length>0?o.data.length-1:0;o.filters[g]=[n,b,c,e]}}}),f.showInterval=Math.ceil(f.chartConfig.xAxis.categories.length/g.maxLabels),f.labelCounter=0,f.i=0,p(o)}}function v(b,c,d,e,g,j,k,l,m,n,o){if(null!=b){0==f.chartConfig.series.length&&(F(),f.chartConfig.options.foo++,i(function(){G()},500)),f.timeSeriesFacets.push(c),0!=f.chartConfig.options.rangeSelector.enabled&&null!=j&&(f.chartConfig.options.rangeSelector.enabled=j),0!=f.chartConfig.options.navigator.enabled&&null!=k&&(f.chartConfig.options.navigator.enabled=k),null!=l&&(f.chartConfig.options.xAxis={events:{afterSetExtremes:function(b){"zoom"==b.trigger&&(angular.forEach(f.timeSeriesFacets,function(b){a.removeFiltersFromUrl(b,!1)}),angular.forEach(f.timeSeriesFacets,function(c,d){var e=new Date(b.min).toISOString(),g=new Date(b.max).toISOString(),h=e.substring(0,e.length-5),i=g.substring(0,g.length-5);a.addRangeFilterToUrl(c,h,i,e,g,d==f.timeSeriesFacets.length-1,!1,"-")}))}}}),d=null==d?b.display:d;var q={name:d,data:[],tooltip:g,type:e,showInNavigator:!0};void 0!=n&&null!=n&&(q.marker=n);var r=[];angular.forEach(b.filters,function(a){if(!isNaN(a.count)){var b=h("actualValue")(a.val);void 0!=b&&"range"==b.type&&(b=b.from),r.push({act:b,count:null==m||"count"==m?a.count:a.facts[m][0]})}}),("true"==o||null==o)&&(r=h("orderBy")(r,"act")),angular.forEach(r,function(a){q.data.push([new Date(a.act).valueOf(),a.count])}),p(q),f.$broadcast("highchartsng.reflow")}}function w(a,b,c,d,e,j,k,l,m,n){if(null!=a){0==f.chartConfig.series.length&&(F(),f.chartConfig.options.foo++,i(function(){G()},500)),e=null==e?c:e;var o=s(e,d,m,n);o.title=o.title||e,angular.forEach(a,function(a){var d=h("displayValue")(a.result.fields[b].val),e=h("actualValue")(a.result.fields[c].val),g=null!=j?h("actualValue")(a.result.fields[j].val):null;if(!isNaN(e))if(e=""==e?null:parseFloat(e),-1!=f.chartConfig.xAxis.categories.indexOf(d))o.data[f.chartConfig.xAxis.categories.indexOf(d)]=[d,e],null!=g?o.urls[f.chartConfig.xAxis.categories.indexOf(d)]=g:null!=k&&(o.filters[f.chartConfig.xAxis.categories.indexOf(d)]=[c,e,e,l]);else{f.chartConfig.xAxis.categories.push(d),o.data.push([d,e]);var i;null!=g?(i=o.data.length>0?o.data.length-1:0,o.urls[i]=g):null!=k&&(i=o.data.length>0?o.data.length-1:0,o.filters[i]=[c,e,e,l])}}),f.showInterval=Math.ceil(f.chartConfig.xAxis.categories.length/g.maxLabels),f.labelCounter=0,p(o)}}function x(a){f.chartConfig.options.exporting=a}function y(a){f.chartConfig.credits=a}function z(a){f.chartConfig.options.legend=a}function A(a){f.chartConfig.options.tooltip=a}function B(a,b,c){if(g.hasOwnProperty("singleFilterMode")){var d={name:a,value:b,count:c};I.push(d),1===I.length?(f.singleFilterOverlay=!0,f.overlayFacet=I[0].name,f.overlayValue=I[0].value,f.overlayCount=I[0].count):f.singleFilterOverlay=!1}}function C(a){if(a&&a.filters&&g.hasOwnProperty("singleFilterMode")&&f.response&&f.response.query&&f.response.query.filters)for(var b=0;b<f.response.query.filters.length;b++)if(a.field==f.response.query.filters[b].field)for(var c=0;c<a.filters.length;c++)f.response.query.filters[b].val==a.filters[c].val&&a.filters[c].count==a["sum-of-counts"]&&B(a.field,a.filters[c].val,a.filters[c].count)}function D(a){if(null!=g.query){var b=d.getQueryAsHttpParams(g.query,a);if(null!=b)return b}}function E(){return g.response}function F(){f.loading<=0&&i(function(){f.chartConfig.loading='<div class="tk-stl-circle-loader"></div>'},0),f.loading++}function G(){f.loading--,f.loading<=0&&i(function(){f.chartConfig.loading=!1},0)}function H(a,b){if(angular.isObject(b)){var c=h("filter")(a,b,!0)[0];return a.indexOf(c)}return a.indexOf(b)}var I=[];f.timeSeriesFacets=[],f.actCategories=[],f.loading=0,f.allSeries=[],null!=g.backgroundColor&&l.warn("ChartDisplay","background-color attribute has been deprecated, please change the background colour using css. Eg #id-of-container .highcharts-background{ fill:pink}. For more info see - http://www.highcharts.com/docs/chart-design-and-style/style-by-css"),null!=g.color&&l.warn("ChartDisplay","color attribute has been deprecated, please change the series colour using css. Eg #id-of-container .highcharts-color-0{ fill:pink; stoke:pink;}. For more info see - http://www.highcharts.com/docs/chart-design-and-style/style-by-css"),f.$watch(function(){return j[0].offsetTop>0&&j[0].offsetLeft>0},function(){j[0].offsetTop>0&&j[0].offsetLeft>0&&f.$broadcast("highchartsng.reflow")}),null!=g.innerSize&&"true"==g.showValue&&(angular.element(k).on("resize",n),f.$on("$destroy",m));var J=this;J.addFacetSeries=u,J.addTimeSeries=v,J.addResultListSeries=w,J.addExportingOptions=x,J.addCreditOptions=y,J.addLegendOptions=z,J.addTooltipOptions=A,J.addSeries=q,J.addPlatformTimeSeries=r,J.getQuery=D,J.getResponse=E,J.setLoading=F,J.unsetLoading=G,f.type=null==g.type?"pie":g.type,g.maxCharacters=null==g.maxCharacters?"250":g.maxCharacters,g.height=null==g.height?"400":g.height,f.removeFilterFromUrl=function(b){a.removeFiltersFromUrl(b,!0)},f.toggleSeries=function(a){if(f.chartConfig&&f.chartConfig.series){for(var b,c=!1,d=0;d<f.chartConfig.series.length;d++)a.id==f.chartConfig.series[d].id&&(c=!0,b=d);c?f.chartConfig.series.splice(b,1):f.chartConfig.series.push(a),f.$broadcast("highchartsng.reflow")}},f.seriesIsSelected=function(a){for(var b=!1,c=0;c<f.chartConfig.series.length;c++)a.id==f.chartConfig.series[c].id&&(b=!0);return b},void 0==f.chartConfig&&(f.chartConfig={options:{foo:1,chart:{},exporting:{enabled:!1},plotOptions:{pie:{dataLabels:{enabled:"false"!=g.showLabels,formatter:function(){f.labelCounter++;var a=parseInt(g.maxCharacters),b=0,c=f.chartConfig.xAxis.categories.indexOf(this.key);if(-1!=c){for(f.i=0;f.i<f.chartConfig.series.length;f.i++)c<f.chartConfig.series[f.i].data.length&&(b+=f.chartConfig.series[f.i].data[c][1]);if(-1!=g.maxLabels||f.labelCounter%f.showInterval==0)return a>0&&this.key.length>a?this.key.substr(0,a)+"..."+("true"==g.showCount?" ("+b+")":""):this.key+("true"==g.showCount?" ("+b+")":"")}}}}},rangeSelector:{enabled:!1},navigator:{enabled:!1}},useHighStocks:!1,size:{height:g.height},series:[],xAxis:{categories:[],title:{text:g.xtitle}},credits:{enabled:!1},yAxis:{title:{text:g.ytitle}},title:{text:g.title},subtitle:{text:g.subtitle},loading:!1,func:function(a){if(i(function(){if(null!=a&&null!=a.hasRendered){if(null!=g.innerSize&&"true"==g.showValue){f.seriesCopy=a.series[0];var b=a.series[0],c=a.renderer,d=a.plotLeft+b.center[0],e=a.plotTop+b.center[1],i=null;angular.forEach(b.points,function(a){null==i?i=a:i.y<a.y&&(i=a)});var j="";j=i.name.length>=56?"6px":i.name.length>=35?"8px":i.name.length>=30?"10px":i.name.length>=25?"12px":i.name.length>=20?"14px":i.name.length>=16?"18px":i.name.length>=12?"20px":"26px",i.slice(!0),c.text(i.name,d,e).attr({"text-anchor":"middle","font-size":j,"font-weight":"800",id:"field-name"}).add(),c.text(h("numberFormat")(i.y,"formatted"),d,e+30).attr({"text-anchor":"middle","font-size":"26px",id:"count"}).add()}a.reflow()}},0),g.websocket){var b=c(g.websocket);b.onMessage(function(b){var c=JSON.parse(b.data);a.series[0].addPoint({y:c.count,name:c.val.dsp})})}}},"time"==g.type&&(f.chartConfig.options.chart.zoomType="x",f.chartConfig.options.rangeSelector.enabled=!0,f.chartConfig.options.navigator.enabled=!0,f.chartConfig.useHighStocks=!0),"radar"==g.radarOrPolar?(f.chartConfig.options.chart.polar=!0,f.chartConfig.yAxis.gridLineInterpolation="polygon",f.chartConfig.yAxis.lineWidth=0,f.chartConfig.xAxis.lineWidth=0,f.chartConfig.xAxis.tickmarkPlacement="on",j.addClass("radar-chart")):"polar"==g.radarOrPolar?(f.chartConfig.options.chart.polar=!0,f.chartConfig.yAxis.gridLineInterpolation="circle",f.chartConfig.yAxis.lineWidth=1,f.chartConfig.xAxis.lineWidth=1,f.chartConfig.xAxis.tickmarkPlacement="on"):f.chartConfig.xAxis.labels={rotation:parseInt(g.xlabelRotation)||0,enabled:"false"!=g.showLabels,formatter:function(){f.labelCounter++;var a=parseInt(g.maxCharacters),b=0,c=f.chartConfig.xAxis.categories.indexOf(this.value);if(-1!=c){for(f.i=0;f.i<f.chartConfig.series.length;f.i++)c<f.chartConfig.series[f.i].data.length&&(b+=f.chartConfig.series[f.i].data[c][1]);if(-1!=g.maxLabels||f.labelCounter%f.showInterval==0)return a>0&&this.value.length>a?this.value.substr(0,a)+"..."+("true"==g.showCount?" ("+b+")":""):this.value+("true"==g.showCount?" ("+b+")":"")}}},null!=g.innerSize&&(f.chartConfig.options.plotOptions.pie.innerSize=g.innerSize),"false"==g.showTooltips&&(f.chartConfig.options.tooltip={enabled:!1}),("true"==g.invertAxes||"bar"==g.type)&&(f.chartConfig.options.chart.inverted=!0),null!=f.options&&angular.extend(f.chartConfig.options,f.options)),null!=g.response?(f.response=e.getResponse(g.response),null!=f.response&&(o(),f.response.facets&&null!=f.response.facets[g.facetName]&&u(f.response.facets[g.facetName],f.type,g.facetName,f.query)),f.$on(g.response+"_updated",function(){o(),f.response.facets&&null!=f.response.facets[g.facetName]&&J.addFacetSeries(f.response.facets[g.facetName],f.type,g.facetName,f.query)})):f.$on("reloadSearch",function(){o()})}],template:function(a,b){var c="";return b.hasOwnProperty("singleFilterMode")&&(c+='<div class="tk-stl-single-filter-mode-wrapper">'),b.hasOwnProperty("response")?(c+='<div class="tk-stl-chart-display" ng-if="response != null">',b.hasOwnProperty("select")&&"checkbox"==b.select&&(c+='<div class="tk-stl-series-select"><a ng-click="showSeriesSelect = !showSeriesSelect">Series</a><div class="popover" ng-show="showSeriesSelect"><input type="text" ng-model="seriesSearch" placeholder="Search series"/><ul><li ng-click="toggleSeries(series)" ng-repeat="series in allSeries | filter:{name: seriesSearch} track by series.id">{{ series.name }}<i class="icon-ok" ng-show="seriesIsSelected(series)"></i></li></ul></div></div>'),c+='<div ng-transclude></div><highchart config="chartConfig"></highchart></div>'):(c+='<div class="tk-stl-chart-display">',b.hasOwnProperty("select")&&"checkbox"==b.select&&(c+='<div class="tk-stl-series-select"><a ng-click="showSeriesSelect = !showSeriesSelect">Series</a><div class="popover" ng-show="showSeriesSelect"><input type="text" ng-model="seriesSearch" placeholder="Search series"/><ul><li ng-click="toggleSeries(series)" ng-repeat="series in allSeries | filter:{title: seriesSearch} track by series.id">{{ series.title }}<i class="icon-ok" ng-show="seriesIsSelected(series)"></i></li></ul></div></div>'),c+='<div ng-transclude></div><highchart config="chartConfig"></highchart></div>'),b.hasOwnProperty("singleFilterMode")&&(c+='<div class="tk-stl-single-filter-overlay clickable" ng-if="singleFilterOverlay" ng-click="removeFilterFromUrl(overlayFacet)"><span class="removeFilter">&times;</span><h4>{{ overlayFacet }}</h4><h2>{{ overlayValue }}</h2><h3>{{ overlayCount }}</h3></div></div>'),c}};return f}angular.module("lightning").directive("chartDisplay",a),a.$inject=["$lightningUrl","$location","$websocket","QueryService","ResponseService"]}(),function(){"use strict";function a(){var a={restrict:"E",transclude:!0,require:["?^^chartDisplay","?^^chartGauge"],link:{pre:function(a,b,c,d){var e=d[0],f=d[1],g={enabled:!0,filename:c.fileName,url:null==c.url?"http://export.highcharts.com":c.url,chartOptions:{chart:{backgroundColor:"white"}}};null!=e?e.addExportingOptions(g):null!=f&&f.addExportingOptions(g)}}};return a}angular.module("lightning").directive("chartExport",a)}(),function(){"use strict";function a(a){var b={restrict:"E",transclude:!0,require:"^^chartDisplay",link:{pre:function(b,c,d,e){var f={title:{text:d.title},x:parseInt(d.x)||0,y:parseInt(d.y)||0,margin:40};null!=d.borderRadius&&a.warn("ChartLegend","border-radius attribute has been deprecated, please set the border-radius using css. Eg #id-of-container .highcharts-legend-box { fill: none; stroke-width: 1px; stroke: black; rx:2;  }. For more info see - http://www.highcharts.com/docs/chart-design-and-style/style-by-css"),null!=d.borderWidth&&a.warn("ChartLegend","border-width attribute has been deprecated, please set the border-width using css. Eg #id-of-container .highcharts-legend-box { fill: none; stroke-width: 1px; stroke: black; rx:2;  }. For more info see - http://www.highcharts.com/docs/chart-design-and-style/style-by-css"),null!=d.align&&(f.align=d.align),null!=d.verticalAlign&&(f.verticalAlign=d.verticalAlign),null!=d.layout&&(f.layout=d.layout),e.addLegendOptions(f)}}};return b}angular.module("lightning").directive("chartLegend",a),a.$inject=["$lightningLog"]}(),function(){"use strict";function a(){var a={restrict:"E",transclude:!0,require:["?^^chartDisplay","?^^seriesFacet","?^^seriesResultList"],link:{pre:function(a,b,c,d){var e=d[0],f=d[1],g=d[2],h={shared:"true"===c.shared};null!=c.headerFormat&&(h.headerFormat=c.headerFormat),null!=c.pointFormat&&(h.pointFormat=c.pointFormat),null!=g?g.addTooltipOptions(h):null!=f?f.addTooltipOptions(h):e.addTooltipOptions(h)}}};return a}angular.module("lightning").directive("chartTooltip",a)}(),function(){"use strict";function a(a,b,c,d,e){var f={restrict:"E",transclude:!0,scope:{},link:function(f,g,h){function i(){var a=j.facets[h.facetName],g=null==h.key?"hc-key":h.key,i=null==h.title?"":h.title,k=null==h.subtitle?"":h.subtitle;if(null==a)return void(f.show=!1);f.show=!0;var l=h.seriesName||a.display||h.facetName;if(null==Highcharts.maps[h.map])return c.error("Chart:Highmaps","Map named - "+h.map+' - could not be found, please make sure the script tag for the map is included. eg <script src="//code.highcharts.com/mapdata/countries/gb/gb-all.js"></script>. Maps can be found at - http://code.highcharts.com/mapdata/'),void(f.show=!1);var m=[];angular.forEach(a.filters,function(a){var c={value:a.count};c[g]=b("actual")(a.val),m.push(c)}),f.config={options:{plotOptions:{map:{mapData:Highcharts.maps[h.map],joinBy:[g]}},mapNavigation:{enabled:!0,buttonOptions:{verticalAlign:"bottom"}},colorAxis:{min:0}},chartType:"map",title:{text:i},subtitle:{text:k},series:[{data:m,mapData:Highcharts.maps[h.map],joinBy:[g],states:{hover:{color:"black"}},events:{click:function(b){if(null!=h.query){var c=d.getQueryAsHttpParams(h.query,!0);null!=c&&e.setUrlParameters(c,!1),e.addFilterToUrl(a.field,b.point.name,b.point.name,!0)}}},name:l,showInLegend:!0},{name:"Separators",type:"mapline",data:Highcharts.geojson(Highcharts.maps[h.map],"mapline"),color:"silver",showInLegend:!1,enableMouseTracking:!1}]}}var j=a.getResponse(h.response,"facets");null!=j?i():f.show=!1,f.$on(h.response+"_updated",function(){j=a.getResponse(h.response,"facets"),i()})},template:function(){var a="<div>";return a+='<highchart config="config" ng-if="show" style="height:700px;"></highchart>',a+="</div>"}};return f}angular.module("lightning").directive("geoHighmaps",a),a.$inject=["ResponseService","$filter","$lightningLog","QueryService","$lightningUrl"]}(),function(){"use strict";function a(a,b,c,d,e,f,g){var h={restrict:"E",scope:{measure:"@"},transclude:!0,require:"^^chartDisplay",controller:["$scope",function(a){function b(b){a.tooltipOptions=b}var c=this;a.tooltipOptions=null,c.addTooltipOptions=b}],link:{post:function(h,i,j,k){function l(a){return null!=j.query?e.getQueryAsHttpParams(j.query,a):k.getQuery(a)}function m(){h.measure=null==h.measure?"count":h.measure,h.query=l(!0),k.setLoading();var a=parseInt(j.numberToShow)?parseInt(j.numberToShow):10,b=l(!1);c.searchSeriesFacet(b,o,j.name,h.measure,a).then(function(a){var b={name:j.name,labelField:"value",valueField:h.measure,type:j.type,title:j.title,action:j.action,dateFormat:j.dateFormat,measure:h.measure,query:h.query,showMarker:j.showMarker,tooltipOptions:h.tooltipOptions};k.addSeries(a.data,b)},function(a){f.error("Series:Facet","Error retrieving series from platform - "+a.status+" - "+a.statusText),k.unsetLoading()})}function n(b){var c=angular.copy(b.facets[j.name]);h.query=l(!0),parseInt(j.numberToShow)&&null!=c&&(c.filters=a("limitTo")(c.filters,j.numberToShow));var d=null;("false"==j.showMarker||"true"==j.showMarker)&&(d={enabled:"true"==j.showMarker}),k.addFacetSeries(c,j.type,j.title,h.query,j.action,h.tooltipOptions,j.dateFormat,h.measure,d)}h.addFacetSeries=n,null!=j.color&&f.warn("SeriesFacet","color attribute has been deprecated, please change the series colour using css. Eg #id-of-container .highcharts-color-0{ fill:pink; stoke:pink;}. For more info see - http://www.highcharts.com/docs/chart-design-and-style/style-by-css");var o,p;if(null!=j.platform)o=b.getPlatform(j.platform),m(),h.$on("reloadSearch",function(){d(function(){m()},0)});else if(null==j.response){var q=k.getResponse();p=g.getResponse(q,"facets"),null!=p&&h.addFacetSeries(p),h.$on(q+"_updated",function(a,b){null!=b&&d(function(){h.addFacetSeries(b)},0)})}else p=g.getResponse(j.response,"facets"),null!=p&&h.addFacetSeries(p),h.$on(j.response+"_updated",function(a,b){null!=b&&d(function(){h.addFacetSeries(b)},0)})}},template:"<div ng-transclude></div>"};return h}angular.module("lightning").directive("seriesFacet",a),a.$inject=["$filter","PlatformService","$twigkit","$timeout","QueryService","$lightningLog","ResponseService"]}(),function(){"use strict";function a(a,b,c,d,e,f){var g={restrict:"E",scope:{response:"=?"},transclude:!0,require:"^^chartDisplay",controller:["$scope",function(a){function b(b){a.tooltipOptions=b}var c=this;a.tooltipOptions=null,c.addTooltipOptions=b}],link:{post:function(g,h,i,j){function k(a){return null!=i.query?e.getQueryAsHttpParams(i.query,a):j.getQuery(a)}function l(){g.query=k(!0),j.setLoading();var a=[];a.push(i.labelField),a.push(i.valueField),null!=i.urlField&&a.push(i.urlField);var c=parseInt(i.numberToShow)?parseInt(i.numberToShow):10,e=k(!1);b.searchSeriesFields(e,m,a.join(","),c).then(function(a){var b={name:i.valueField,labelField:i.labelField,valueField:i.valueField,type:i.type,title:i.title,action:i.action,urlField:i.urlField,query:g.query,showMarker:i.showMarker,tooltipOptions:g.tooltipOptions};d(function(){j.addSeries(a.data,b)},0)},function(a){f.error("Series:ResultList","Error retrieving series from platform - "+a.status+" - "+a.statusText),j.unsetLoading()})}null!=i.color&&f.warn("SeriesResultList","color attribute has been deprecated, please change the series colour using css. Eg #id-of-container .highcharts-color-0{ fill:pink; stoke:pink;}. For more info see - http://www.highcharts.com/docs/chart-design-and-style/style-by-css");var m;null!=i.platform?(m=c.getPlatform(i.platform),d(function(){l()},0),g.$on("reloadSearch",function(){d(function(){l()},0)})):g.response||null!=i.response?g.$watch("response",function(a){null!=a&&g.addResultListSeries(a)}):g.$watch("$parent.response",function(a){a&&g.addResultListSeries(a)}),g.addResultListSeries=function(b){var c=angular.copy(b.results);g.query=k(!0),parseInt(i.numberToShow)&&(c=a("limitTo")(c,i.numberToShow));var d=null;("false"==i.showMarker||"true"==i.showMarker)&&(d={enabled:"true"==i.showMarker}),j.addResultListSeries(c,i.labelField,i.valueField,i.type,i.title,i.urlField,g.query,i.action,g.tooltipOptions,d)}}},template:"<div ng-transclude></div>"};return g}angular.module("lightning").directive("seriesResultList",a),a.$inject=["$filter","$twigkit","PlatformService","$timeout","QueryService","$lightningLog"]}(),function(){"use strict";function a(a,b,c,d,e){var f={restrict:"E",scope:{response:"=?",measure:"@"},transclude:!0,require:"^^chartDisplay",controller:["$scope",function(a){function b(b){a.tooltipOptions=b}var c=this;a.tooltipOptions=null,c.addTooltipOptions=b}],link:{post:function(f,g,h,i){function j(a){return null!=h.query?d.getQueryAsHttpParams(h.query,a):i.getQuery(a)}function k(){f.measure=null==f.measure?"count":f.measure,f.query=j(!0),i.setLoading();var a=parseInt(h.numberToShow)?parseInt(h.numberToShow):25,b=j(!1);c.searchSeriesFacet(b,l,h.name,f.measure,a).then(function(a){var b={name:h.name,labelField:"value",valueField:f.measure,type:f.type,title:h.title,query:null!=h.query?f.query:null,showMarker:h.showMarker,tooltipOptions:f.tooltipOptions,rangeSelector:"false"!=h.rangeSelector,navigator:"false"!=h.navigator,sort:h.sort};i.addPlatformTimeSeries(a.data,b)},function(a){e.error("Series:Time","Error retrieving series from platform - "+a.status+" - "+a.statusText),i.unsetLoading()})}null!=h.color&&e.warn("SeriesTime","color attribute has been deprecated, please change the series colour using css. Eg #id-of-container .highcharts-color-0{ fill:pink; stoke:pink;}. For more info see - http://www.highcharts.com/docs/chart-design-and-style/style-by-css"),f.type=null==h.type?"spline":h.type;var l;null!=h.platform?(l=a.getPlatform(h.platform),k(),f.$on("reloadSearch",function(){b(function(){k()},0)})):f.response||null!=h.response?f.$watch("response",function(a){null!=a&&f.addTimeSeries(a)}):f.$watch("$parent.response",function(a){a&&f.addTimeSeries(a)}),f.addTimeSeries=function(a){var b=angular.copy(a.facets[h.name]),c="false"!=h.rangeSelector,d="false"!=h.navigator,e=null;f.query=j(!0),("false"==h.showMarker||"true"==h.showMarker)&&(e={enabled:"true"==h.showMarker}),i.addTimeSeries(b,h.name,h.title,f.type,f.tooltipOptions,c,d,f.query,f.measure,e,h.sort)}}},template:"<div ng-transclude></div>"};return f}angular.module("lightning").directive("seriesTime",a),a.$inject=["PlatformService","$timeout","$twigkit","QueryService","$lightningLog"]}(),function(){"use strict";function a(){var a={restrict:"E",transclude:!0,scope:{value:"@",min:"@",max:"@",title:"@",stops:"=?",valueSuffix:"@"},controller:["$scope","$timeout",function(a,b){function c(b){a.chartConfig.options.exporting=b}function d(b){a.chartConfig.credits=b}var e=this;e.addExportingOptions=c,e.addCreditOptions=d,a.defaultStops=[[.1,"#DF5353"],[.5,"#DDDF0D"],[.9,"#55BF3B"]],a.stops=null==a.stops?a.defaultStops:a.stops,a.$watch("value",function(b){b&&(a.chartConfig.series[0].data[0]=parseInt(b))}),a.$watch("min",function(b){b&&(a.chartConfig.yAxis.min=parseInt(b))}),a.$watch("max",function(b){b&&(a.chartConfig.yAxis.max=parseInt(b),a.chartConfig.yAxis.tickInterval=parseInt(a.max))}),a.chartConfig={options:{chart:{type:"solidgauge"},pane:{center:["50%","85%"],size:"140%",startAngle:-90,endAngle:90,background:{backgroundColor:"#EEE",innerRadius:"60%",outerRadius:"100%",shape:"arc"}},plotOptions:{solidgauge:{dataLabels:{y:5,borderWidth:0,useHTML:!0}}},tooltip:{enabled:!1},exporting:{enabled:!1}},series:[{data:[parseInt(a.value)],dataLabels:{borderWidth:0,format:'<div style="text-align:center"><span style="font-size:25px;color:black">{y}</span><br/><span style="font-size:12px;color:silver">'+(null==a.valueSuffix?"<br/>":a.valueSuffix)+"</span></div>"}}],title:{text:a.title,y:50},yAxis:{min:parseInt(a.min),max:parseInt(a.max),title:{y:140},stops:a.stops,lineWidth:0,minorTickInterval:null,tickInterval:a.max,tickWidth:0,labels:{y:15}},loading:!1,useHighStocks:!1,func:function(a){b(function(){a.reflow()},0)}}}],template:function(){return'<div ng-if="value != null"><ng-transclude></ng-transclude><highchart config="chartConfig"></highchart></div>'}};return a}angular.module("lightning").directive("chartGauge",a)}(),function(){
"use strict";function a(){var a={restrict:"E",scope:{response:"=?",facet:"=?",facetName:"@",action:"@"},require:"^?searchFacet",controller:["$scope","$lightningUrl","$attrs","$filter","$location","QueryService",function(a,b,c,d,e,f){function g(){a.settingFilter=!1,a.maxCount=a.facet["max-count"],null!=c.title&&""!=c.title.trim()&&(a.title=c.title),a.filters=angular.copy(a.facet.filters),a.filters=d("limitTo")(a.filters,a.show),angular.forEach(a.filters,function(b){b.act=d("actualValue")(b.val),b.dsp=d("displayValue")(b.val),b.height=b.count>0?b.count/a.maxCount*100:0,b.ngDsp=b.dsp,c.dateFormat?"undefined"!=typeof b.ngDsp.indexOf?0==b.ngDsp.indexOf("<")?(b.ngDsp=b.ngDsp.substring(1),b.ngDsp=d("dateFormat")(b.ngDsp.trim(),c.dateFormat),b.ngDsp="< "+b.ngDsp):0==b.ngDsp.indexOf(">")?(b.ngDsp=b.ngDsp.substring(1),b.ngDsp=d("dateFormat")(b.ngDsp.trim(),c.dateFormat),b.ngDsp="> "+b.ngDsp):b.ngDsp=d("dateFormat")(b.dsp,c.dateFormat):b.ngDsp=d("dateFormat")(b.dsp,c.dateFormat):a.maxChars>-1&&(b.ngDsp=d("maxCharacters")(b.dsp,a.maxChars))})}a.show=parseInt(c.show)?parseInt(c.show):20,a.maxChars=parseInt(c.maxCharacters)?parseInt(c.maxCharacters):20,a.settingFilter=!1,a.height=null==c.height?"100px":c.height,null!=c.response?a.$watch("response",function(b){b&&(a.response=b,a.facet=a.response.facets[a.facetName]||a.facet,g())}):a.$watch("facet",function(b){b&&(a.facet=b,g())}),a.applyFilter=function(d){if(!a.settingFilter){a.settingFilter=!0;var g=d.act,h=d.dsp;if(c.dateFormat&&(h=d.ngDsp),null!=c.query){var i=f.getQueryAsHttpParams(c.query,!0);null!=i&&b.setUrlParameters(i,!1)}null!=a.action?(null!=d.val.act&&"range"==d.val.act.type?b.addRangeFilterDisplayToUrl(a.facet.id,d.val.act.from,d.val.act.to,h,!1,!1,d.val.act.fromExcluded,d.val.act.toExcluded):b.addRangeFilterDisplayToUrl(a.facet.id,g,g,h,!1,!1,!1,!1),e.path(a.action)):null!=d.val.act&&"range"==d.val.act.type?b.addRangeFilterDisplayToUrl(a.facet.id,d.val.act.from,d.val.act.to,h,!0,!1,d.val.act.fromExcluded,d.val.act.toExcluded):b.addRangeFilterDisplayToUrl(a.facet.id,g,g,h,!0,!1,!1,!1)}}}],link:function(a,b,c,d){null!=d&&a.facet&&(a.facet.filters.length>1?d.showFacet(!0):d.showFacet(!1))},template:function(a,b){var c="";return c+='<div class="histogram-container" ng-show="facet.filters.length > 1">',null!=b.title&&(c+='<h3 class="facet-title">{{::title}}</h3>'),c+='<ol class="histogram bars-{{facet.filters.length > show ? show : facet.filters.length}}">',c+='<li ng-style="::{\'height\': height}" ng-repeat="filter in filters">',c+='<div class="bar" ng-style="::{\'height\':filter.height + \'%\'}" ng-click="applyFilter(filter)">',c+="<label>{{::filter.ngDsp}}","true"==b.showCount&&(c+='<span class="histogram-metadata"><span class="count"> ({{::filter.count}})</span></span>'),c+="</label>",c+="</div>",c+="</li>",c+="</ol>",c+="</div>"}};return a}angular.module("lightning").directive("chartHistogram",a)}(),function(){"use strict";function a(){var a={restrict:"E",scope:{response:"=?",facet:"=?",facetName:"@",action:"@"},controller:["$scope","$lightningUrl","$attrs","$filter","$location",function(a,b,c,d,e){function f(){a.settingFilter=!1,null==a.facet?a.facet={filters:[]}:(a.maxCount=a.facet["max-count"],a.minCount=a.facet["min-count"],a.level=a.maxCount/c.numberOfLevels,null!=c.title&&""!=c.title.trim()&&(a.title=c.title))}a.show=parseInt(c.show)?parseInt(c.show):15,a.settingFilter=!1,c.numberOfLevels=parseInt(c.numberOfLevels)?parseInt(c.numberOfLevels):10,null!=c.response?a.$watch("response",function(b){b&&(a.response=b,a.facet=a.response.facets[a.facetName]||a.facet,f())}):a.$watch("facet",function(b){b&&(a.facet=b,f())}),a.getWeighting=function(b){a.maxCount=a.facet["max-count"],a.minCount=a.facet["min-count"],a.level=a.maxCount/c.numberOfLevels;for(var d=1;d<=c.numberOfLevels;){if(b>a.level*(d-1)&&b<=a.level*d)return d;d++}},a.applyFilter=function(c){a.settingFilter||(a.settingFilter=!0,null!=a.action?(b.addFilterToUrl(a.facet.id,d("actualValue")(c.val),d("displayValue")(c.val),!1),e.path(a.action)):b.addFilterToUrl(a.facet.id,d("actualValue")(c.val),d("displayValue")(c.val),!0))},a.greaterThan=function(a,b){return function(c){return null!=c[a]&&c[a]>b?!0:void 0}}}],template:function(a,b){var c,d,e=["val","count","weight"];null!=b.order&&0==b.order.indexOf("-")?(c=!0,d=b.order.substring(1)):null!=b.order&&0==b.order.indexOf("+")?(c=!1,d=b.order.substring(1)):(c=!1,d=b.order);var f=-1!=e.indexOf(d)?e[e.indexOf(d)]:"val",g="";return g+='<h3 class="facet-title" ng-show="title != null">{{::title}}</h3>',g+='<div class="tagcloud">',g+="<ol>",g+="<li ng-repeat=\"filter in facet.filters | filter:greaterThan('count',0) | orderBy:'"+f+"' : "+c+' | limitTo: show" class="level{{getWeighting(filter.count)}}">',g+='<a href="javascript:void(0);" ng-click="applyFilter(filter)">{{::filter.val | displayValue}}</a>',g+="</li>",g+="</ol>",g+="</div>"}};return a}angular.module("lightning").directive("chartTagcloud",a)}(),function(){"use strict";function a(a,b,c,d,e){var f={restrict:"E",scope:{},transclude:!0,replace:!0,link:function(f,g,h){function i(){if(f.response.results&&f.response.results.length>0){var b=m(f.response.results);f.groups=a.groupByDateRanges(b,h.date)}}function j(){f.platform=d.getPlatform(h.platform);var g=e.getQueryAsHttpParams(h.query),i=b.getParams(p,g);return void 0!=i.searchParams.p&&i.searchParams.p>o?(i.searchParams.p=i.searchParams.p+1,o=i.searchParams.p):(o+=1,i.searchParams.p=o),i.searchParams.p>f.lastPage?(f.loading=!1,void(f.disabled=!0)):void c.search(i.query,f.platform,i.searchParams).then(function(b){p=!0,angular.forEach(b.data.results,function(a){f.response.results.push(a)});var c=m(f.response.results);f.groups=a.groupByDateRanges(c,h.date),f.lastPage=b.data.hits.act[1]/b.data.query.rpp,b.data.hits.act[1]%b.data.query.rpp>0&&(f.lastPage+=1),f.lastPage=Math.floor(f.lastPage),f.loading=!1},function(){p=!0,f.loading=!1})}function k(){if(!f.loading&&!f.disabled){var a="horizontal"==h.orientation,b=l(q,30,a);b&&(f.loading=!0,j())}}function l(a,b,c){var d=c?a.scrollLeft:a.scrollTop,e=c?a.offsetWidth:a.offsetHeight,f=c?a.scrollWidth:a.scrollHeight;return d+e>=f-b}function m(b){var c;if(h.sort){var d="oldest"==h.sort;c=a.dateSortResults(b,h.date,d)}else c=b;return c}f.response=b.getResponse(h.response);var n=f.$on(h.response+"_updated",function(a,b){f.response=b,null!=f.response&&i()});f.$on("$destroy",function(){n()}),null!=f.response&&i();var o=1,p=!1;if(h.platform&&null!=h.query){var q=g[0];g.bind("scroll",k),f.$on("$destroy",function(){g.unbind("scroll",k)})}},template:function(a,b){var c=b.orientation||"vertical",d='style="',e=!1;b.maxHeight&&(d+="max-height: "+b.maxHeight+"px;",e=!0),b.maxWidth&&(d+="max-width: "+b.maxWidth+"px;",e=!0),d+='"',d=e?d:"";var f="";return f+='<div class="tk-stl-timeline-container" '+d+">",f+='<ul class="tk-stl-timeline '+c+'">',f+='<li class="time-slot" ng-repeat="milestone in groups">',f+='<div class="milestone">{{ milestone.label }}</div>',f+='<div class="events">',f+='<div class="entry" ng-repeat="event in milestone.events" ng-inject>',f+='<div class="content">{{ event.result.fields.name.val[0] }}</div>',f+="<div class=\"metadata\">{{ event.result.fields[attributes.date].val[0] | date:'medium' }}</div>",f+="</div>",f+="</div>",f+="</li>",f+="</ul>",f+="</div>"}};return f}angular.module("lightning").directive("chartTimeline",a),a.$inject=["DateUtils","ResponseService","$twigkit","PlatformService","QueryService"]}();